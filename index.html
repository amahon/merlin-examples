<!DOCTYPE html>
<html lang="en">
	
	<head>
		
		<meta charset="utf-8">
		
		<title>Merlin! (typecode-js merlin example 0)</title>

		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<link rel="stylesheet" type="text/css" href="css/main.css" />
		<link rel="stylesheet" type="text/css" href="css/advent.css" />
		
	</head>
	
	<body>
	
		<header>

			<a href="#">
				<pre> __  __         _ _      _ </pre>
				<pre>|  \/  |___ _ _| (_)_ _ | |</pre>
				<pre>| |\/| / -_) '_| | | ' \|_|</pre>
				<pre>|_|  |_\___|_| |_|_|_||_(_)</pre>
			</a>
			&copy; 2012, Type/Code LLC

		</header>
		
		<img src="img/loading.gif" class="loading" />
		
		<div class='merlin' id='text-adventure'>

			<div class='step char-name'>
				
				<p>Welcome to <em>Merlin!</em>, a demonstration of <a href="#">Merlin</a> in the form of a quick text adventure. Type 'HELP' anytime for a quick tutorial.</p>
				
				<p>Let's start with your character's name.<br /> (press 'ENTER' to continue).</p>

				<div class='prompt'>
					<input name='name' class='name-field' />
				</div>
				
			</div>
			
			<div class='step char-occupation'>

				<p>What is <span class='character-name'></span>'s occupation? (Press 'ENTER' to continue).</p>
				
				<p>
					<input type='radio' name='occupation_action' id='webdeveloper' value='webdeveloper'/>
					<label for='webdeveloper'> Web Developer</label>
				</p>
				<p>
					<input type='radio' name='occupation_action' id='spelunker' value='spelunker'/>
					<label for='spelunker'> Spelunker</label>
				</p>
				<p>
					<input type='radio' name='occupation_action' id='back' value='back'/>
					<label for='back'> &larr; Change character name</label>
				</p>
				
				<a href="#" class="next-btn"></a>
				<a href="#" class="prev-btn"></a>

				<div class='prompt'>
					<input name='occupation' class='occupation-field' />
				</div>
				
			</div>
			
			<div class='step webdeveloper-one'>

				<p><span class='character-name'></span> wakes up under a desk in a dim room full of them. Identical computers sit darkened on each, some mat rest screenside. The monitor above <span class='character-name'></span></p>

				<div class='prompt'>
					<input name='webdeveloper-one' class='webdeveloper-1-field' />
				</div>
				
			</div>
			
			<div class='step spelunker-one'>

				<p><span class='character-name'></span> wakes up under a desk in a dim room full of them. Identical computers sit darkened on each, some mat rest screenside. The monitor above <span class='character-name'></span></p>

				<div class='prompt'>
					<input name='spelunker-one' class='spelunker-1-field' />
				</div>
				
			</div>

		</div>


		<!-- jQuery 1.6.3, Hosted on Google CDN -->
		<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js'></script>
		
		<!-- jQuery Hashchange v1.3, source version -->
		<script type='text/javascript' src='https://raw.github.com/cowboy/jquery-hashchange/v1.3/jquery.ba-hashchange.js'></script>
		
		<!-- Type/Code Libraries -->
		<script src="js/lib/typecode-js/lib/tc.seed.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/typecode-js/lib/tc.merlin.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/typecode-js/lib/tc.validation.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/lib/typecode-js/lib/tc.field.js" type="text/javascript"></script>
		<script src="js/lib/typecode-js/lib/field/tc.field.validator.js" type="text/javascript"></script>
		<script src="js/lib/typecode-js/lib/field/tc.field.std.js" type="text/javascript"></script>
		<script src="js/lib/typecode-js/lib/field/tc.field.dropdown.js" type="text/javascript"></script>
		<script src="js/lib/typecode-js/lib/field/tc.field.simple_tooltip.js" type="text/javascript"></script>
		
		<!-- Example Application - Merlin! -->
		<script type="text/javascript" charset="utf-8">

			$(function(){
			
				$(document).bind('click', {}, function(e,d){
				
					console.log('document.click');

					if ( window.my_merlin.internal.current_step.$e.find('.prompt input').length ) {
						window.my_merlin.internal.current_step.$e.find('.prompt input').focus();
					}

					if( window.my_merlin.internal.current_step.fields && window.my_merlin.internal.current_step.fields.prompt) {
						window.my_merlin.internal.current_step.fields.name.component.event_receiver.focus();		
					}
				
				});
				
				$(document).bind('keydown', function(event){

					if ( 13 == event.keyCode ) {

						$('a.next-btn').click();

					}

				});
				
				window.my_merlin = new NI.Merlin({

					name:'advent',

					$e:$('#text-adventure'),
					
					controls:{
						next:'.next-btn',
						prev:'.prev-btn'
					},
 
					data:{
						name: null,
						occupation: null
					},

					transition:'crossfade',

					first_step:'char-name',

					steps:{
						
						'char-name':{
							selector:'.step.char-name',
							next:'char-occupation',
							fields:{
								'name':{
									selector:'input[name=name]',
									options:{
										extensions:{
											Validator:{
												validators:['minlen=2','maxlen=64','required']
											}
										}
									}
								}
							},
							visible:function(me){
								//i commented this out because it was causing validation to be triggered,
								//and state-invalid class to be added to the .tc-field and .step
								//me.internal.current_step.fields.name.component.set_val('');
							},
							finish:function(me){	
								me.set_val('name', me.internal.current_step.fields.name.component.get_val());
							}
						},

						'char-occupation':{
							selector:'.step.char-occupation',
							fields:{
								'occupation':{
									selector:'input[name=occupation_action]',
									options:{
										sexy:false,
										handlers:{
											change:function(e){
												if ( e.data.me.get_val() == 'webdeveloper' ) {
													e.data.merlin.internal.current_step.$e.find('.prompt').text(
														window.my_merlin.get_val('name') + ' is a sad half-human :-['
													);
												}
												if ( e.data.me.get_val() == 'spelunker' ) {
													e.data.merlin.internal.current_step.$e.find('.prompt').text(
														window.my_merlin.get_val('name') + ' is a cave exploring adventurer!'
													);
												}
												if ( e.data.me.get_val() == 'back' ) {
													e.data.merlin.internal.current_step.$e.find('.prompt').text(
														window.my_merlin.get_val('name') + ' isn\'t working for you? Press \'ENTER\' to continue'
													);
												}
											}
										}
									}
								}
							},
							next:function(me){
								switch(me.internal.current_step.fields.occupation.component.get_val()){
									case 'webdeveloper':
										return 'webdeveloper-one';
									case 'spelunker':
										return 'spelunker-one';
									case 'back':
										return 'char-name';
								}
							},
							prev:'char-name',
							visible:function(me){
								me.internal.current_step.$e.find('.character-name').text(me.get_val('name'));
								console.log(me);
							},
							finish:function(me){	
								me.set_val('occupation', me.internal.current_step.fields.occupation.component.get_val());
							}
						},

						'webdeveloper-one':{
							selector:'.step.webdeveloper-one',
							prev:'char-occupation',
							visible:function(me){
								//i commented this out because it was causing validation to be triggered,
								//and state-invalid class to be added to the .tc-field and .step
								//me.internal.current_step.fields.name.component.set_val('');
							},
							finish:function(me){	
								me.set_val('name', me.internal.current_step.fields.name.component.get_val());
							}
						},

						'spelunker-one':{
							selector:'.step.spelunker-one',
							prev:'char-occupation',
							visible:function(me){
								//i commented this out because it was causing validation to be triggered,
								//and state-invalid class to be added to the .tc-field and .step
								//me.internal.current_step.fields.name.component.set_val('');
							},
							finish:function(me){	
								me.set_val('name', me.internal.current_step.fields.name.component.get_val());
							}
						}

					}

				});
				
				console.log(window.my_merlin);
				
				window.my_merlin.internal.current_step.$e.find('.prompt input').focus();
				
			});
			
			$(window).load(function() {
				
				$('.loading').remove();
				
				$('.step').css('visibility','visible');
				
				$(document).click();
			
			});
			
		</script>
		
	</body>
</html>