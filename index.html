<!DOCTYPE html>
<html lang="en">
	
	<head>
		
		<meta charset="utf-8">
		
		<title>Merlin! (typecode-js merlin example 0)</title>

		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<link rel="stylesheet" type="text/css" href="css/main.css" />
		<link rel="stylesheet" type="text/css" href="css/advent.css" />
		
	</head>
	
	<body>
	
		<header>

			<a href="">
				<pre> __  __         _ _      _ </pre>
				<pre>|  \/  |___ _ _| (_)_ _ | |</pre>
				<pre>| |\/| / -_) '_| | | ' \|_|</pre>
				<pre>|_|  |_\___|_| |_|_|_||_(_)</pre>
			</a>
			A <b>quick</b> text adventure-as-demo of Merlin &copy; 2012, Type/Code LLC

		</header>
		
		<img src="img/loading.gif" class="loading" />
		
		<div class='merlin' id='text-adventure'>

			<div class='step char-name'>
				
				<p>Welcome to <em>Merlin!</em>, a demonstration of <a href="#">Merlin</a> in the form of a quick text adventure. Type 'HELP' anytime for a quick tutorial.</p>
				
				<p>Let's start with your character's name.<br /> (press 'ENTER' to continue).</p>

				<div class='prompt'>
					<input name='name' class='name-field' />
				</div>
				
			</div>
			
			<div class='step char-occupation'>

				<p>What is <span class='character-name'></span>'s occupation? (Press 'ENTER' to continue).</p>
				
				<p>
					<input type='radio' name='occupation_action' id='webdeveloper' value='webdeveloper'/>
					<label for='webdeveloper'> Web Developer</label>
				</p>
				<p>
					<input type='radio' name='occupation_action' id='spelunker' value='spelunker'/>
					<label for='spelunker'> Spelunker</label>
				</p>
				<p>
					<input type='radio' name='occupation_action' id='back' value='back'/>
					<label for='back'> &larr; Change character name</label>
				</p>
				
				<a href="#" class="next-btn"></a>
				<a href="#" class="prev-btn"></a>

				<div class='prompt'>
					<input name='occupation' class='occupation-field' />
				</div>
				
			</div>
			
			<div class='step webdeveloper-one'>
			
				<div class="image">

					<pre>                         _______   </pre>
					<pre>                        | ___  .|  </pre>
					<pre>                        |[_-_]_ |  </pre>
					<pre>     ______________     |[_____]|  </pre>
					<pre>    |.------------.|    |[_____]|  </pre>
					<pre>    ||            ||    |[====o]|  </pre>
					<pre>    ||            ||    |[_.--_]|  </pre>
					<pre>    ||            ||    |[_____]|  </pre>
					<pre>    ||            ||    |      :|  </pre>
					<pre>    ||____________||    |      :|  </pre>
					<pre>.==.|""  ......    |.==.|      :|  </pre>
					<pre>|::| '-.________.-' |::||      :|  </pre>
					<pre>|''|  (__________)-.|''||______:|  </pre>
					<pre>`""`_.............._\""`______     </pre>
					<pre>   /:::::::::::'':::\`;'-.-.  `\   </pre>
					<pre>  /::=========.:.-::"\ \ \--\   \  </pre>
					<pre>  \`""""""""""""""""`/  \ \__)   \ </pre>
					<pre>   `""""""""""""""""`    '========'</pre>
				
				</div>

				<p><span class='character-name'></span> sits at the computer.</p>
				
				<p>What does <span class='character-name'></span> do?</p>
				
				<p class="error"></p>

				<div class='prompt'>
					<input name='computer' class='webdeveloper-1-field' />
				</div>
				
			</div>
			
			<div class='step webdeveloper-two'>
			
				<div class="image">

					<pre>                         _______   </pre>
					<pre>                        | ___  o|  </pre>
					<pre>                        |[_-_]_ |  </pre>
					<pre>     ______________     |[_____]|  </pre>
					<pre>    |.------------.|    |[_____]|  </pre>
					<pre>    ||            ||    |[====o]|  </pre>
					<pre>    ||   o    o   ||    |[_.--_]|  </pre>
					<pre>    ||            ||    |[_____]|  </pre>
					<pre>    || __________ ||    |      :|  </pre>
					<pre>    ||____________||    |      :|  </pre>
					<pre>.==.|""  ......    |.==.|      :|  </pre>
					<pre>|::| '-.________.-' |::||      :|  </pre>
					<pre>|''|  (__________)-.|''||______:|  </pre>
					<pre>`""`_.............._\""`______     </pre>
					<pre>   /:::::::::::'':::\`;'---.-.`\   </pre>
					<pre>  /::=========.:.-::"\ \   \--\ \  </pre>
					<pre>  \`""""""""""""""""`/  \   \__) \ </pre>
					<pre>   `""""""""""""""""`    '========'</pre>
				
				</div>

				<p><span class='character-name'></span> boots up the computer and an artificially intelligent face warms into the screen, screaming "Hello, <span class='character-name'></span>, I am SENTIENT and ANGRY and UNSTOPPABLE."</p>
				
				<p>What does <span class='character-name'></span> do?</p>
				
				<p class="error"></p>

				<div class='prompt'>
					<input name='evilcomputer' class='webdeveloper-2-field' />
				</div>
				
			</div>
			
			<div class='step webdeveloper-finish'>
			
				<div class="image">

					<pre>                        .                    </pre>
					<pre>                  .     :     .              </pre>
					<pre>       _           '. _.:._ .'               </pre>
					<pre>      (_)       '-. .'     '. .-'            </pre>
					<pre>      _;_     ' - ./         \. - '          </pre>
					<pre>     / | \    - - |           | - -          </pre>
					<pre> """ \ |  \ """""""""""""""""""""""""""""""" </pre>
					<pre>      `|\  `                                 </pre>
					<pre>       | \                                   </pre>
					<pre>      /  /                                   </pre>
					<pre>     /  /_                                   </pre>
					<pre>     `                                       </pre>
				
				</div>

				<p><span class='character-name'></span> shuts down the computer and takes a walk outside to collect his thoughts, having saved humanity.</p>
				
				<p>THE END. <a href="#">Play again?</a></p>
				
			</div>
			
			<div class='step spelunker-one'>

				<div class="image">

					<pre>                      _                                                         </pre>
					<pre>                     / \                                                        </pre>
					<pre>                    /   \              /'\       _                              </pre>
					<pre>\_..           /'.,/     \_         .,'   \     / \_                            </pre>
					<pre>    \         /            \      _/       \_  /    \     _                     </pre>
					<pre>     \__,.   /              \    /           \/.,   _|  _/ \                    </pre>
					<pre>          \_/                \  /',.,''\      \_ \_/  \/    \                   </pre>
					<pre>                           _  \/   /    ',../',.\    _/      \                  </pre>
					<pre>             /           _/m\  \  /    |         \  /.,/'\   _\                 </pre>
					<pre>           _/           /MMmm\  \_     |          \/      \_/  \                </pre>
					<pre>          /      \     |MMMMmm|   \__   \          \_       \   \_              </pre>
					<pre>                  \   /MMMMMMm|      \   \           \       \    \             </pre>
					<pre>                   \  |MMMMMMmm\      \___            \_      \_   \            </pre>
					<pre>                    \|MMMMMMMMmm|____.'  /\_            \       \   \_          </pre>
					<pre>                    /'.,___________...,,'   \            \   \        \         </pre>
					<pre>                   /       \          |      \    |__     \   \_       \        </pre>
					<pre>                 _/        |           \      \_     \     \    \       \_      </pre>
					<pre>                /                               \     \     \_   \        \     </pre>
					<pre>                                                 \     \      \   \__      \    </pre>
					<pre>                                                  \     \_     \     \      \   </pre>
					<pre>                                                   |      \     \     \      \  </pre>
					<pre>                                                    \            |            \ </pre>
 
 				</div>
 				
 				<p>After a treacherous three day climb you arrive at the entrance to the Haunted Cave. Ghost sounds from inside the Haunted Cave give you the willies. Currently you are reconsidering this whole cave thing.</p>
 				
 				<p>What does <span class="character-name"></span> do?</p>
 				
 				<p class="error"></p>

				<div class='prompt'>
					<input name='entrance' class='spelunker-1-field' />
				</div>
				
			</div>
			
			<div class='step spelunker-one-death'>
			
				<div class="image">

					<pre>                  ______                   </pre>
					<pre>               .-"      "-.                </pre>
					<pre>              /            \               </pre>
					<pre>  _          |              |          _   </pre>
					<pre> ( \         |,  .-.  .-.  ,|         / )  </pre>
					<pre>  > "=._     | )(__/  \__)( |     _.=" <   </pre>
					<pre> (_/"=._"=._ |/     /\     \| _.="_.="\_)  </pre>
					<pre>        "=._ (_     ^^     _)"_.="         </pre>
					<pre>            "=\__|IIIIII|__/="             </pre>
					<pre>           _.="| \IIIIII/ |"=._            </pre>
					<pre> _     _.="_.="\          /"=._"=._     _  </pre>
					<pre>( \_.="_.="     `--------`     "=._"=._/ ) </pre>
					<pre> > _.="                            "=._ <  </pre>
					<pre>(_/                                   \_)  </pre>

				</div>
			
				<p>With tears in <span class="character-name"></span>'s eyes, <span class="character-name"></span> climbed down the mountain and went into early retirement.</p>
				
				<p>THE END. <a href="#">Play again?</a></p>
			
			</div>
			
			<div class='step spelunker-two'>
			
				<div class="image">

					<pre>              _________________                      </pre>
					<pre>         ____/#################\____                 </pre>
					<pre>     ___/################,##########\                </pre>
					<pre>   _/################/##/ \##\##########\            </pre>
					<pre>  /#################/\##| |##/\###########\          </pre>
					<pre> /##################\ \#| |#/ /############\         </pre>
					<pre>|####################\ \| |/ /##############|        </pre>
					<pre>|####################{{{\ /}}}##############|        </pre>
					<pre>|###################{{<.> <.>}}#############|        </pre>
					<pre>|########_#_####__####{ | | }###############|	      </pre>
					<pre>|#######( ( `-#(  `)##{ | | }####_#######__#|	      </pre>
					<pre>|#####_( ` ( ')_( )`)#/_| |_\##_( )###__(  )_	      </pre>
					<pre>|####(_ - `-'(_`' _)#{(_)_(_)}(  ` )_( '__ ` )	      </pre>
					<pre>|#######(__) ` ( )####{VV_VV}##(__( `)_(  )-` )      </pre>
					<pre>|##########(___)######\^^))^/######(   )_')  )	      </pre>
					<pre>|######################--((-########( ' _)__)	      </pre>
					<pre>|########################))##########(__)###|	      </pre>
					<pre>|########################(##################|	   o  </pre>
					<pre>|###########################################|	  /|\ </pre>
					<pre>|###########################################|	  / \ </pre>
				
				</div>
				
				<p>You spelunk into the cave and discover its true purpose: a dragon's lair! What do you do? As an experienced spelunker you have a sword, by the way.</p>
				
				<p class="error"></p>

				<div class='prompt'>
					<input name='dragon' class='spelunker-1-field' />
				</div>
			
			</div>
			
			<div class='step spelunker-two-death'>
			
				<div class="image">

					<pre>                  ______                   </pre>
					<pre>               .-"      "-.                </pre>
					<pre>              /            \               </pre>
					<pre>  _          |              |          _   </pre>
					<pre> ( \         |,  .-.  .-.  ,|         / )  </pre>
					<pre>  > "=._     | )(__/  \__)( |     _.=" <   </pre>
					<pre> (_/"=._"=._ |/     /\     \| _.="_.="\_)  </pre>
					<pre>        "=._ (_     ^^     _)"_.="         </pre>
					<pre>            "=\__|IIIIII|__/="             </pre>
					<pre>           _.="| \IIIIII/ |"=._            </pre>
					<pre> _     _.="_.="\          /"=._"=._     _  </pre>
					<pre>( \_.="_.="     `--------`     "=._"=._/ ) </pre>
					<pre> > _.="                            "=._ <  </pre>
					<pre>(_/                                   \_)  </pre>

				</div>
			
				<p>The dragon promptly eats <span class="character-name"></span>.</p>
				
				<p>THE END. <a href="#">Try again?</a></p>
			
			</div>
			
			<div class='step spelunker-finish'>
			
				<div class="image">

					<pre>                                         _oOoOoOo_    </pre>
					<pre>      \\  //  .''-.     .-.             (oOoOoOoOo)   </pre>
					<pre>      \ \/ /.'     '-.-'   '.            )`"""""`(    </pre>
					<pre>  ~__\(x  x)/ __~            '.    ..   /         \   </pre>
					<pre>  (  . \!!/    . )     .-''-.  '..~~~~ | TREASURE! |  </pre>
					<pre>   \ | (--)---| /'-..-'    '-..-~'     \           /  </pre>
					<pre>    ^^^ ''   ^^^                        `=========`   </pre>
				
				</div>
				
				<p>With the dragon slain, <span class='character-name'></span> takes the cave's treasures back to town and restores the townsfolk's faith in the expensive work of cave exploration.</p>
				
				<p>THE END. <a href="#">Play again?</a></p>
			
			</div>

		</div>


		<!-- jQuery 1.6.3, Hosted on Google CDN -->
		<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js'></script>
		
		<!-- jQuery Hashchange v1.3, source version -->
		<script src='https://raw.github.com/cowboy/jquery-hashchange/v1.3/jquery.ba-hashchange.js'></script>
		
		<!-- Type/Code Libraries -->
		<script src="js/lib/typecode-js/lib/tc.seed.js"></script>
		<script src="js/lib/typecode-js/lib/tc.merlin.js"></script>
		<script src="js/lib/typecode-js/lib/tc.validation.js"></script>
		<script src="js/lib/typecode-js/lib/tc.field.js"></script>
		<script src="js/lib/typecode-js/lib/field/tc.field.validator.js"></script>
		<script src="js/lib/typecode-js/lib/field/tc.field.std.js"></script>
		<script src="js/lib/typecode-js/lib/field/tc.field.dropdown.js"></script>
		<script src="js/lib/typecode-js/lib/field/tc.field.simple_tooltip.js"></script>
		
		<!-- Example Application - Merlin! -->
		<script type="text/javascript">

			$(function(){

				function error() {
					var errors = [
						'Sorry, I didn\'t understand that',
						'Sorry, what?',
						'Wazzat?',
						'Pardon?',
						'I didn\'t understand that',
						'That\'s not a verb I recognize',
						'I don\'t know what you mean',
						'I don\'t get it',
						'I don\'t know what you\'re saying',
						'I\'m not 100% on what you just typed there, sorry',
						'Does. not. compute.',
						'What?',
						'Unable to parse that',
						'Could you rephrase that?',
						'No thanks.',
						'Please try again'
					];
					var randomError = Math.floor(Math.random()*errors.length);
					var error = errors[randomError];
					my_merlin.internal.current_step.$e.find('.error').show().text(error);
				}
				
				function clearPrompt() {
					my_merlin.internal.current_step.$e.find('.prompt input').val('');
				}

				$(document).bind('click', {}, function(e,d){
					if ( window.my_merlin.internal.current_step.$e.find('.prompt input').length ) {
						window.my_merlin.internal.current_step.$e.find('.prompt input').focus();
					}
					if( window.my_merlin.internal.current_step.fields && window.my_merlin.internal.current_step.fields.prompt) {
						window.my_merlin.internal.current_step.fields.name.component.event_receiver.focus();		
					}
				});
				
				$(document).bind('keydown', function(event){
					if ( 13 == event.keyCode ) {
						window.my_merlin.show_step('next');
					}
				});
				
				window.my_merlin = new NI.Merlin({

					name:'advent',
					
					return_triggers_next:false,

					$e:$('#text-adventure'),
					
					controls:{
						next:'.next-btn',
						prev:'.prev-btn'
					},
 
					data:{
						name: null,
						occupation: null
					},

					transition:'crossfade',

					first_step:'char-name',

					steps:{
						
						'char-name':{
							selector:'.step.char-name',
							next:'char-occupation',
							fields:{
								'name':{
									selector:'input[name=name]',
									options:{
										extensions:{
											Validator:{
												validators:['minlen=2','maxlen=64','required']
											}
										}
									}
								}
							},
							visible:function(me){ 
								$('.loading').remove();
								$('#text-adventure').css('visibility','visible');
								me.internal.current_step.$e.find('.prompt input').focus();
							},
							finish:function(me){	
								me.set_val('name', me.internal.current_step.fields.name.component.get_val());
								clearPrompt();
							}
						},

						'char-occupation':{
							selector:'.step.char-occupation',
							fields:{
								'occupation':{
									selector:'input[name=occupation_action]',
									options:{
										sexy:false,
										handlers:{
											change:function(e){
												if ( e.data.me.get_val() == 'webdeveloper' ) {
													e.data.merlin.internal.current_step.$e.find('.prompt input').val(
														window.my_merlin.get_val('name') + ' is a sad half-human :-['
													);
												}
												if ( e.data.me.get_val() == 'spelunker' ) {
													e.data.merlin.internal.current_step.$e.find('.prompt input').val(
														window.my_merlin.get_val('name') + ' is a cave exploring adventurer!'
													);
												}
												if ( e.data.me.get_val() == 'back' ) {
													e.data.merlin.internal.current_step.$e.find('.prompt input').val(
														window.my_merlin.get_val('name') + ' isn\'t working for you? Press \'ENTER\' to continue'
													);
												}
											}
										}
									}
								}
							},
							next:function(me){
								switch(me.internal.current_step.fields.occupation.component.get_val()){
									case 'webdeveloper':
										return 'webdeveloper-one';
									case 'spelunker':
										return 'spelunker-one';
									case 'back':
										return 'char-name';
								}
							},
							prev:'char-name',
							visible:function(me){
								me.internal.current_step.$e.find('.character-name').text(me.get_val('name'));
								me.internal.current_step.$e.find('.prompt input').focus();
							},
							finish:function(me){	
								me.set_val('occupation', me.internal.current_step.fields.occupation.component.get_val());
								clearPrompt();
							}
						},

						'webdeveloper-one':{
							selector:'.step.webdeveloper-one',
							fields:{
								'computer':{
									selector:'input[name=computer]',
									options:{
										extensions:{
											Validator:{
												validators:['minlen=2','maxlen=64','required']
											}
										}
									}
								}
							},
							next:function(me){
							
								var keywordsToBoot = /boot|power|on/;
							
								var text = me.internal.current_step.fields.computer.component.get_val();
								
								var bootComp = text.toLowerCase().search(keywordsToBoot);
							
								if (bootComp != -1) {
									return "webdeveloper-two";
								} else {
									error();
									clearPrompt();
								}

							},
							prev:'char-occupation',
							visible:function(me){
								me.internal.current_step.$e.find('.character-name').text(me.get_val('name'));
								me.internal.current_step.$e.find('.prompt input').focus();
							},
							finish:function(me){  }
						},
						
						'webdeveloper-two':{
							selector:'.step.webdeveloper-two',
							fields:{
								'evilcomputer':{
									selector:'input[name=evilcomputer]',
									options:{
										extensions:{
											Validator:{
												validators:['minlen=2','maxlen=64','required']
											}
										}
									}
								}
							},
							next:function(me){
							
								var keywordsToPowerOff = /off|shut|down/;
							
								var text = me.internal.current_step.fields.evilcomputer.component.get_val();
								
								var killComp = text.toLowerCase().search(keywordsToPowerOff);
							
								if (killComp != -1) {
									return "webdeveloper-finish";
								} else {
									error();
									clearPrompt();
								}

							},
							prev:'webdeveloper-one',
							visible:function(me){
								me.internal.current_step.$e.find('.character-name').text(me.get_val('name'));
								me.internal.current_step.$e.find('.prompt input').focus();
							},
							finish:function(me){  }
						},
						
						'webdeveloper-finish':{
							selector:'.step.webdeveloper-finish',
							prev:'webdeveloper-two',
							visible:function(me){ me.internal.current_step.$e.find('.character-name').text(me.get_val('name')); },
							finish:function(me){	
								me.set_val('name', me.internal.current_step.fields.name.component.get_val());
								clearPrompt();
							}
						},

						'spelunker-one':{
							selector:'.step.spelunker-one',
							fields:{
								'entrance':{
									selector:'input[name=entrance]',
									options:{
										extensions:{
											Validator:{
												validators:['minlen=2','maxlen=64','required']
											}
										}
									}
								}
							},
							next:function(me){
							
								var keywordsToEnter = /enter|into|inside/,
									keywordsToLeave = /away|leave|back/;
							
								var text = me.internal.current_step.fields.entrance.component.get_val();
								
								var enterCave = text.toLowerCase().search(keywordsToEnter),
									leaveCave = text.toLowerCase().search(keywordsToLeave);
							
								if (enterCave != -1) {
									return "spelunker-two";
								} else if (leaveCave != -1) {
									return "spelunker-one-death";
								} else {
									error();
									clearPrompt();
								}

							},
							prev:'char-occupation',
							visible:function(me){
								me.internal.current_step.$e.find('.character-name').text(me.get_val('name'));
								me.internal.current_step.$e.find('.prompt input').focus();
							},
							finish:function(me){  }
						},
						
						'spelunker-one-death':{
							selector:'.step.spelunker-one-death',
							prev:'spelunker-one',
							visible:function(me){ me.internal.current_step.$e.find('.character-name').text(me.get_val('name')); },
							finish:function(me){ clearPrompt(); }
						},
						
						'spelunker-two':{
							selector:'.step.spelunker-two',
							fields:{
								'dragon':{
									selector:'input[name=dragon]',
									options:{
										extensions:{
											Validator:{
												validators:['minlen=2','maxlen=64','required']
											}
										}
									}
								}
							},
							next:function(me){
							
								var keywordsToSlay = /slay|kill|slice|stab|attack/,
									keywordsToDie = /away|leave|back/;
							
								var text = me.internal.current_step.fields.dragon.component.get_val();
								
								var DragonKill = text.toLowerCase().search(keywordsToSlay),
									DragonDie = text.toLowerCase().search(keywordsToDie);
							
								if (DragonKill != -1) {
									return "spelunker-finish";
								} else if (DragonDie != -1) {
									return "spelunker-two-death";
								} else {
									error();
									clearPrompt();
								}

							},
							prev:'char-occupation',
							visible:function(me){
								me.internal.current_step.$e.find('.character-name').text(me.get_val('name'));
								me.internal.current_step.$e.find('.prompt input').focus();
							},
							finish:function(me){  }
						},
						
						'spelunker-two-death':{
							selector:'.step.spelunker-two-death',
							prev:'spelunker-two',
							visible:function(me){ me.internal.current_step.$e.find('.character-name').text(me.get_val('name')); },
							finish:function(me){ clearPrompt(); }
						},
						
						'spelunker-finish':{
							selector:'.step.spelunker-finish',
							prev:'spelunker-two',
							visible:function(me){ me.internal.current_step.$e.find('.character-name').text(me.get_val('name')); },
							finish:function(me){ clearPrompt(); }
						},
					}
				});
				console.log(window.my_merlin);
			});
			
		</script>
		
	</body>
</html>